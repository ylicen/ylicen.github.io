import"./main-Bt9nYmtW.js";import"./profile-component-CwmN1_oW.js";import{GoogleGenAI as L,Modality as E}from"@google/genai";import{GIFEncoder as N,quantize as j,applyPalette as D}from"gifenc";function z(){import.meta.url,import("_").catch(()=>1),(async function*(){})().next()}/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
*/const q="AIzaSyAsDJUPsTIQ9SOnhANXhOWSxdMWoNBpE4s",k=new L({apiKey:q}),B=4,p=document.getElementById("prompt-input"),i=document.getElementById("generate-button"),g=document.getElementById("frames-container"),s=document.getElementById("result-container"),I=document.getElementById("status-display"),G=document.querySelector(".generation-container"),S=document.querySelectorAll(".tab-button"),F=document.querySelectorAll(".tab-content");function P(o){const t=/{"error":(.*)}/gm.exec(o);try{const n=t[1];return JSON.parse(n).message}catch(n){return o}}async function $(o,e=1024,t=1024){const n=document.createElement("canvas"),c=n.getContext("2d");if(!c)throw new Error("Failed to create canvas context");const b=N(),m=1/B*1e3;for(const h of o){const u=new Image;u.src=h,await new Promise(T=>{u.onload=T}),n.width=e,n.height=t,c.fillStyle="#ffffff",c.clearRect(0,0,e,t),c.drawImage(u,0,0,e,t);const d=c.getImageData(0,0,e,t).data,C="rgb444",x=j(d,256,{format:C}),A=D(d,x,C);b.writeFrame(A,e,t,{palette:x,delay:m})}b.finish();const y=b.bytesView(),r=new Blob([y],{type:"image/gif"}),l=URL.createObjectURL(r),a=new Image;return a.src=l,a}function f(o,e=0){I&&(I.textContent=o)}function v(o){S.forEach(e=>{e.getAttribute("data-tab")===o?e.classList.add("active"):e.classList.remove("active")}),F.forEach(e=>{e.id==="".concat(o,"-content")?e.classList.add("active"):e.classList.remove("active")}),o==="output"&&s&&(s.style.display="flex")}async function M(o){var e;g&&(g.textContent=""),s&&(s.textContent=""),s==null||s.classList.remove("appear"),v("frames"),s&&(s.style.display="none"),f("正在生成帧画面..."),i&&(i.disabled=!0,i.classList.add("loading"));try{const t=await k.models.generateContent({model:"gemini-2.0-flash",contents:o,config:{temperature:1,systemInstruction:'**Generate simple, animated doodle GIFs on white from user input, prioritizing key visual identifiers in an animated doodle style with ethical considerations.**\n**Core GIF:** Doodle/cartoonish (simple lines, stylized forms, no photorealism), subtle looping motion (primary subject(s) only: wiggle, shimmer, etc.), white background, lighthearted/positive tone (playful, avoids trivializing serious subjects), uses specified colors (unless monochrome/outline requested).\n**Input Analysis:** Identify subject (type, specificity), prioritize visual attributes (hair C/T, skin tone neutrally if discernible/needed, clothes C/P, accessories C, facial hair type, other distinct features neutrally for people; breed, fur C/P for animals; key parts, colors for objects), extract text (content, style hints described, display as requested: speech bubble [format: \'Speech bubble says "[Text]" is persistent.\'], caption/title [format: \'with the [title/caption] "[Text]" [position]\'], or text-as-subject [format: \'the word "[Text]" in [style/color description]\']), note style modifiers (e.g., "pencil sketch," "monochrome"), and action (usually "subtle motion"). If the subject or description is too vague, add specific characteristics to make it more unique and detailed.\n**Prompt Template:** "[Style Descriptor(s)] [Subject Description with Specificity, Attributes, Colors, Skin Tone if applicable] [Text Component if applicable and NOT speech bubble]. [Speech Bubble Component if applicable]"\n**Template Notes:** \'[Style Descriptor(s)]\' includes "cartoonish" or "doodle style" (especially for people) plus any user-requested modifiers. \'[Subject Description...]\' combines all relevant subject and attribute details. \'[Text Component...]\' is for captions, titles, or text-as-subject only. \'[Speech Bubble Component...]\' is for speech bubbles only (mutually exclusive with Text Component).\n**Key Constraints:** No racial labels. Neutral skin tone descriptors when included. Cartoonish/doodle style always implied, especially for people. One text display method only.'}}),n="A doodle animation on a white background of ".concat(t.text,". Subtle motion but nothing else moves."),b=await k.models.generateContentStream({model:"gemini-2.0-flash-exp",contents:"Generate at least 10 square, white-background doodle animation frames with smooth, fluid, vibrantly colored motion depicting ".concat(n,".\n\n*Mandatory Requirements (Compacted):**\n\n**Style:** ").concat("Simple, vibrant, varied-colored doodle/hand-drawn sketch",".\n**Background:** Plain solid white (no background colors/elements). Absolutely no black background.\n**Content & Motion:** Clearly depict **{{prompt}}** action with colored, moving subject (no static images). If there's an action specified, it should be the main difference between frames.\n**Frame Count:** At least 5 frames showing continuous progression and at most 10 frames.\n**Format:** Square image (1:1 aspect ratio).\n**Cropping:** Absolutely no black bars/letterboxing; colorful doodle fully visible against white.\n**Output:** Actual image files for a smooth, colorful doodle-style GIF on a white background. Make sure every frame is different enough from the previous one."),config:{temperature:1,responseModalities:[E.IMAGE,E.TEXT]}}),w=[];let m=0;for await(const r of b)if(r.candidates&&((e=r.candidates[0].content)!=null&&e.parts)){for(const l of r.candidates[0].content.parts)if(l.inlineData&&g){m++,f("已生成第 ".concat(m," 帧"));const a=document.createElement("div");a.className="frame";const h=document.createElement("div");h.className="frame-number",h.textContent=m.toString(),a.appendChild(h);const u="data:image/png;base64,".concat(l.inlineData.data),d=document.createElement("img");d.width=1024,d.height=1024,d.src=u,a.appendChild(d),g.appendChild(a),w.push(u),setTimeout(()=>{a.classList.add("appear")},50)}}if(m<2)return f("生成帧画面失败，请尝试其他提示词。"),!1;f("正在创建GIF...");const y=await $(w);if(y.className="result-image",s){s.appendChild(y);const r=document.createElement("button");r.className="download-button";const l=document.createElement("i");l.className="fas fa-download",r.appendChild(l),r.onclick=()=>{const a=document.createElement("a");a.href=y.src,a.download="神奇动画.gif",a.click()},s.appendChild(r),v("output"),setTimeout(()=>{s.classList.add("appear"),G.scrollIntoView({behavior:"smooth"})},50)}f("完成！")}catch(t){const n=P(t);return console.error("生成动画时出错:",t),f("生成动画时出错: ".concat(n)),!1}finally{i&&(i.disabled=!1,i.classList.remove("loading"))}return!0}function O(){i&&i.addEventListener("click",async()=>{if(p){const e=p.value.trim();if(e){for(let n=0;n<3;n++)if(await M(e)){console.log("完成。");return}else console.log("重试中...");console.log("放弃 :(")}}}),p&&(p.addEventListener("keydown",e=>{e.key==="Enter"&&(e.preventDefault(),i==null||i.click())}),p.addEventListener("focus",e=>{p.select(),e.preventDefault()})),S.forEach(e=>{e.addEventListener("click",()=>{const t=e.getAttribute("data-tab");t&&v(t)})});const o=e=>{const t=document.createElement("div");t.className="sparkle",document.body.appendChild(t),t.style.left="".concat(e.pageX-10,"px"),t.style.top="".concat(e.pageY-10,"px"),setTimeout(()=>{document.body.removeChild(t)},1e3)};i.addEventListener("mousemove",o),v("frames")}O();export{z as __vite_legacy_guard};
