{% extends "base.html" %}
{% block title %}预定您的门票{% endblock %}

{% block content %}
<div class="container mx-auto p-8 pt-24" data-aos="fade-up">
    <h1 class="text-4xl font-playfair-display text-center mb-12">预定门票</h1>
    
    <form id="booking-form" action="{{ url_for('booking') }}" method="POST" class="max-w-2xl mx-auto bg-white p-8 rounded-xl shadow-lg">
        <!-- Date Picker -->
        <div class="mb-6">
            <label for="booking_date" class="block text-gray-700 text-sm font-bold mb-2">选择日期:</label>
            <input type="date" id="booking_date" name="booking_date" class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline" required>
        </div>

        <!-- Ticket Selection -->
        <div class="mb-6">
            <h2 class="text-xl font-bold mb-4">选择门票:</h2>
            {% for ticket in tickets %}
            <div class="flex justify-between items-center mb-4 ticket-item" data-price="{{ ticket.price }}">
                <div>
                    <p class="font-semibold">{{ ticket.name }}</p>
                    <p class="text-sm text-gray-600">{{ ticket.description }} (¥{{ "%.2f"|format(ticket.price * 7) }})</p>
                </div>
                <div class="flex items-center">
                    <button type="button" class="quantity-btn minus-btn bg-gray-200 p-2 rounded-l">-</button>
                    <input type="number" name="ticket_{{ ticket.id }}" value="0" min="0" class="quantity-input w-12 text-center border-t border-b">
                    <button type="button" class="quantity-btn plus-btn bg-gray-200 p-2 rounded-r">+</button>
                </div>
            </div>
            {% endfor %}
        </div>

        <!-- User Information -->
        <div class="mb-6">
            <label for="name" class="block text-gray-700 text-sm font-bold mb-2">全名:</label>
            <input type="text" id="name" name="name" class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline" required>
        </div>
        <div class="mb-8">
            <label for="email" class="block text-gray-700 text-sm font-bold mb-2">邮箱:</label>
            <input type="email" id="email" name="email" class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline" required>
        </div>

        <!-- Total Price & Submit -->
        <div class="flex justify-between items-center bg-gray-100 p-4 rounded-lg">
            <p class="text-xl font-bold">总计: ¥<span id="total-price">0.00</span></p>
            <button type="submit" class="aurora-btn bg-teal-500 text-white font-bold py-3 px-8 rounded-full text-lg transition-transform transform hover:scale-105">
                确认预定
            </button>
        </div>
    </form>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const form = document.getElementById('booking-form');
    const quantityButtons = form.querySelectorAll('.quantity-btn');
    const totalPriceEl = document.getElementById('total-price');
    
    function updateTotal() {
        let total = 0;
        form.querySelectorAll('.ticket-item').forEach(item => {
            const price = parseFloat(item.dataset.price);
            const quantity = parseInt(item.querySelector('.quantity-input').value);
            total += price * quantity;
        });
        totalPriceEl.textContent = (total * 7).toFixed(2); // 假设汇率
    }

    quantityButtons.forEach(button => {
        button.addEventListener('click', () => {
            const input = button.parentElement.querySelector('.quantity-input');
            let value = parseInt(input.value);
            if (button.classList.contains('plus-btn')) {
                value++;
            } else if (button.classList.contains('minus-btn') && value > 0) {
                value--;
            }
            input.value = value;
            updateTotal();
        });
    });

    // Also update on manual input change
    form.querySelectorAll('.quantity-input').forEach(input => {
        input.addEventListener('change', updateTotal);
    });

    // Set min date to today
    const datePicker = document.getElementById('booking_date');
    const today = new Date().toISOString().split('T')[0];
    datePicker.setAttribute('min', today);
});
</script>
{% endblock %}